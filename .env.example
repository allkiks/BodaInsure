# =============================================================================
# BodaInsure Platform - Docker Development Environment
# =============================================================================
# This file is configured for Docker Compose development.
# All service hostnames use Docker service names (postgres, redis, minio, etc.)
#
# Usage:
#   docker-compose -f docker/dev/docker-compose.yml up -d
#   make dev-docker
# =============================================================================

# =============================================================================
# INFRASTRUCTURE CONFIGURATION
# =============================================================================

# PostgreSQL Database (Docker service name)
DB_HOST=postgres
DB_PORT=5432
DB_USERNAME=bodainsure
DB_PASSWORD=bodainsure
DB_NAME=bodainsure
DB_SSL=false
DB_LOGGING=true
DB_POOL_SIZE=10

# Redis (Docker service name)
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# MinIO (S3-compatible storage)
MINIO_ROOT_USER=bodainsure
MINIO_ROOT_PASSWORD=bodainsure123

# pgAdmin (optional)
PGADMIN_EMAIL=admin@bodainsure.co.ke
PGADMIN_PASSWORD=admin123

# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================

NODE_ENV=development
PORT=3000
API_PREFIX=api/v1

# JWT Authentication
JWT_SECRET=docker-dev-secret-change-in-production-min-32-chars
JWT_EXPIRES_IN=30d
JWT_REFRESH_EXPIRES_IN=90d
JWT_ALGORITHM=HS256

# Rate Limiting
RATE_LIMIT_TTL=60
RATE_LIMIT_MAX=100

# CORS
CORS_ORIGIN=http://localhost:5173,http://client:5173,http://localhost:3000

# =============================================================================
# ENCRYPTION & SECURITY
# =============================================================================

ENCRYPTION_KEY=MDEyMzQ1Njc4OTAxMjM0NTY3ODkwMTIzNDU2Nzg5MDE=

# =============================================================================
# EMAIL CONFIGURATION (MailHog)
# =============================================================================

EMAIL_ENABLED=true
EMAIL_FROM=BodaInsure <noreply@bodainsure.co.ke>
EMAIL_REPLY_TO=support@bodainsure.co.ke
SMTP_HOST=mailhog
SMTP_PORT=1025
SMTP_USER=
SMTP_PASS=
SMTP_SECURE=false

# =============================================================================
# OBJECT STORAGE (MinIO in Docker)
# =============================================================================

STORAGE_PROVIDER=aws
STORAGE_BUCKET=bodainsure-documents

AWS_ACCESS_KEY_ID=bodainsure
AWS_SECRET_ACCESS_KEY=bodainsure123
AWS_REGION=us-east-1
AWS_S3_BUCKET=kyc-documents
AWS_S3_ENDPOINT=http://minio:9000
AWS_S3_FORCE_PATH_STYLE=true
AWS_S3_PUBLIC_ENDPOINT=http://localhost:9000

# =============================================================================
# M-PESA SANDBOX CONFIGURATION
# =============================================================================
# Daraja API Sandbox - https://developer.safaricom.co.ke
#
# To test with real M-Pesa sandbox (instead of mock):
#
#   STEP 1: Get ngrok authtoken
#   ---------------------------
#   Get free ngrok authtoken: https://dashboard.ngrok.com/get-started/your-authtoken
#   Set NGROK_AUTHTOKEN below
#
#   STEP 2: Start ngrok (runs separately from main stack)
#   -----------------------------------------------------
#   docker compose -f docker/dev/docker-compose.ngrok.yml up -d
#
#   NOTE: ngrok runs independently so the URL doesn't change when you
#   restart the main dev stack. Only restart ngrok when necessary.
#
#   STEP 3: Get your ngrok URL
#   --------------------------
#   docker logs bodainsure-ngrok-dev
#   OR visit http://localhost:4040
#
#   STEP 4: Update callback URLs below with your ngrok URL
#   ------------------------------------------------------
#   Replace the ngrok URL in MPESA_CALLBACK_URL, MPESA_B2C_RESULT_URL,
#   and MPESA_B2C_TIMEOUT_URL with your ngrok URL.
#
#   STEP 5: Set MPESA_USE_MOCK=false
#
# Test phone number for sandbox: 254708374149

MPESA_ENABLED=true
MPESA_ENVIRONMENT=sandbox
MPESA_USE_MOCK=false

# ngrok authtoken (get from https://dashboard.ngrok.com/get-started/your-authtoken)
NGROK_AUTHTOKEN=2esu3m6mR2dBCnO9JzZa0gy0iVo_2He6nVHZuoZq2AsgXMxHd

# App Credentials (from Daraja portal)
MPESA_CONSUMER_KEY=o5Yfns7QJrhETIvypoLdRNBveGgtwNoBeJzZoppoCAtAtsaQ
MPESA_CONSUMER_SECRET=VQOfjVAhAT5JCNJDcqVWzO3bCtch1WhKlGh3sZfHmkIQsC4D3FvZxY8ChWfA2G5A

# STK Push (Lipa Na M-Pesa Online) - Sandbox Test Credentials
MPESA_SHORTCODE=174379
MPESA_PASSKEY=bfb279f9aa9bdbcf158e97dd71a467cd2e0c893059b10f78e6b72ada1ed2c919

# Callback URL (requires public URL - use ngrok for local testing)
# Replace with your ngrok URL when testing with real sandbox
MPESA_CALLBACK_URL=https://4cde5803b856.ngrok-free.app/api/v1/payments/mpesa/callback

# Allow localhost callbacks in development (for mock mode)
MPESA_ALLOW_LOCALHOST_CALLBACK=true

# B2C (Business to Customer) - For refunds - Sandbox Test Credentials
MPESA_B2C_SHORTCODE=600998
MPESA_B2C_INITIATOR_NAME=testapi
MPESA_B2C_SECURITY_CREDENTIAL=PqhkaGDmAdsM7xwoi1wro+zwWbiC/jJ/Fxuu/aG0impwFONXDkhMPX4+mAv8m885q/ge/bzS409Lu5OTwNVdGYNUjejIbA0BFgCoYNAyXc3zn0GAaMvrZXTPupRzGEi0JWv4wQ+p2oX9tD0Zo3Qdi+wD/S/bbpHKtTqn1jLgyIrXqeTNebFtXSNJsF6yo2wbVuaL3Ilz4djaO4cO1aWiXmPDBFYYlFjLAtbKhL/xdc8gJfy6d6g47288Vndcu/s+B/08at4v/ODngXn2CPZjbR2avj59FwRtJoWzigpEeYJeQnZ2CgHsds754RxhL5fYh6BX88YR7h0SNuXDaotxXQ==
MPESA_B2C_RESULT_URL=https://4cde5803b856.ngrok-free.app/api/v1/payments/mpesa/b2c/result
MPESA_B2C_TIMEOUT_URL=https://4cde5803b856.ngrok-free.app/api/v1/payments/mpesa/b2c/timeout

# =============================================================================
# SMS GATEWAY (Disabled for local development)
# =============================================================================

SMS_ENABLED=false
SMS_PRIMARY_PROVIDER=africastalking
SMS_FALLBACK_PROVIDER=advantasms
SMS_MAX_RETRIES=3
SMS_RETRY_DELAY_MS=1000

AT_ENABLED=false
AT_API_KEY=874a5f2af67c2735d3b3f92c0a83a8cdfe73b8a84881043d18b4dd184b7a238b
AT_USERNAME=qwibkenya
AT_SENDER_ID=BodaInsure
AT_USSD_CALLBACK_URL=https://localhost:3000/api/v1/ussd/africastalking

ADVANTASMS_ENABLED=false
ADVANTASMS_BASE_URL=https://quicksms.advantasms.com/api/services
ADVANTASMS_API_KEY=YOUR_ADVANTASMS_API_KEY
ADVANTASMS_PARTNER_ID=YOUR_ADVANTASMS_PARTNER_ID
ADVANTASMS_SENDER_ID=BodaInsure
ADVANTASMS_USSD_CALLBACK_URL=https://localhost:3000/api/v1/ussd/advantasms

# =============================================================================
# WHATSAPP (Disabled for local development)
# =============================================================================

WHATSAPP_ENABLED=false
WHATSAPP_ACCESS_TOKEN=YOUR_WHATSAPP_ACCESS_TOKEN
WHATSAPP_PHONE_NUMBER_ID=YOUR_PHONE_NUMBER_ID
WHATSAPP_BUSINESS_ACCOUNT_ID=YOUR_BUSINESS_ACCOUNT_ID
WHATSAPP_API_VERSION=v18.0

# =============================================================================
# USSD (Disabled for local development)
# =============================================================================

USSD_ENABLED=false
USSD_PRIMARY_PROVIDER=africastalking
USSD_SHORTCODE=*384*123#
USSD_SERVICE_CODE=*384*123#

# =============================================================================
# SCHEDULER & QUEUE
# =============================================================================

SCHEDULER_ENABLED=true
GRACE_PERIOD_DAYS=7
QUEUE_DEFAULT_ATTEMPTS=3
QUEUE_DEFAULT_BACKOFF=exponential

# =============================================================================
# CLIENT CONFIGURATION (Vite)
# =============================================================================

DOCKER_ENV=true
VITE_API_URL=http://localhost:3000/api/v1
VITE_APP_NAME=BodaInsure Admin
VITE_SESSION_TIMEOUT=30
VITE_ENABLE_MOCK_DATA=false

# =============================================================================
# MOBILE CONFIGURATION (Expo)
# =============================================================================

EXPO_PUBLIC_API_URL=http://localhost:3000/api/v1
EXPO_PUBLIC_APP_NAME=BodaInsure
EXPO_PUBLIC_ENABLE_MOCK_DATA=false
